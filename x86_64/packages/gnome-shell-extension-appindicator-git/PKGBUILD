pkgname=gnome-shell-extension-appindicator-git
pkgdesc="AppIndicator Support - add KStatusNotifierItem support to the Shell."
pkgver=r479.5ebb018
pkgrel=1
_gitname=gnome-shell-extension-appindicator
arch=('any')
url="https://github.com/ubuntu/gnome-shell-extension-appindicator"
license=("GPLv3")
install="appindicator.install"
depends=('gnome-shell' 'libappindicator-gtk3')
makedepends=('eslint' 'meson' 'ninja' 'git' 'unzip')

_dir="${_gitname}"
source=("git+https://github.com/ubuntu/gnome-shell-extension-appindicator.git")
sha256sums=("SKIP")

pkgver() {
    cd "${srcdir}/${_dir}"
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    meson "${srcdir}/${_dir}"
}

package() {

    mkdir -p "${pkgdir}/usr/share/gnome-shell/extensions/appindicatorsupport@rgcjonas.gmail.com"

    ninja zip-file

    unzip "/tmp/g-s-appindicators-build/appindicatorsupport@rgcjonas.gmail.com.zip" -d "${pkgdir}/usr/share/gnome-shell/extensions/appindicatorsupport@rgcjonas.gmail.com/"

    install -Dm644 "${srcdir}/${_dir}/schemas/org.gnome.shell.extensions.appindicator.gschema.xml" -t "$pkgdir/usr/share/glib-2.0/schemas"
}