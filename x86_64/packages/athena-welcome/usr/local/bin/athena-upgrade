#!/bin/sh

echo -e "\e[32mAthena Upgrade Tool"
echo
echo -e "Update all the packages..."
echo
sudo pacman -Syyu
touch "$HOME/flag-work-once"
echo
echo -e "\e[32mSynchronize the updated configuration files in your HOME folder..."
echo
echo -e "Pay attention! Generally, this process is discouraged because could overwrite application config files that you customized."
echo

echo -e "\e[33m[01/16] Do you wish to replace your .bashrc with the updated one? Type 'No' if you customized it.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync "/etc/skel/.bashrc" "$HOME/.bashrc"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[02/16] Do you wish to replace .bash_aliases with the updated one? Type 'No' if you customized it.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync "/etc/skel/.bash_aliases" "$HOME/.bash_aliases"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[03/16] Do you wish to update Kitty config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.config/kitty/" "$HOME/.config/kitty/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[04/16] Do you wish to update Neofetch config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.config/neofetch/" "$HOME/.config/neofetch/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[05/16] Do you wish to update PowerShell config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.config/powershell/" "$HOME/.config/powershell/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[06/16] Do you wish to update menu dock application shortcuts config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.local/share/applications/" "$HOME/.local/share/applications/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[07/16] Do you wish to update tmux plugin and config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.tmux/" "$HOME/.tmux/"; rsync "/etc/skel/.tmux.conf" "$HOME/.tmux.conf"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[08/16] Do you wish to update Vim plugin and config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.vim_runtime/" "$HOME/.vim_runtime/"; rsync "/etc/skel/.viminfo" "$HOME/.viminfo"; rsync "/etc/skel/.vimrc" "$HOME/.vimrc"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[09/16] Do you wish to update PenTOXIC menu, PWNage menu and other extension config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync "/etc/skel/dconf-interface.ini" "$HOME/dconf-interface.ini"; rsync "/etc/skel/dconf-preferences.ini" "$HOME/dconf-preferences.ini"; rsync "/etc/skel/dconf-shell.ini" "$HOME/dconf-shell.ini"; break;;
        No ) break;;
    esac
done

package="athena-brave-config"
if pacman -Qi $package > /dev/null 2>&1 ; then
    echo -e "\e[33m[10/16] Do you wish to update Brave Browser profile? Type 'No' if you added additional bookmarks or extensions in the current profile.\e[0m"
    select yn in "Yes" "No"; do
        case $yn in
            Yes )            
            systemctl --user stop psd
            systemctl --user disable psd
            mkdir -p "$HOME/.config/BraveSoftware/Brave-Browser"
            sudo rsync -a --delete "/etc/skel/.config/BraveSoftware/Brave-Browser/" "$HOME/.config/BraveSoftware/Brave-Browser/"; rsync -a --delete "/etc/skel/.config/psd/" "$HOME/.config/psd/";
            sudo chown -LR $USER "$HOME/.config/BraveSoftware"; sudo chgrp -LR $USER "$HOME/.config/BraveSoftware"
            systemctl --user enable psd
            systemctl --user start psd
            break;;
            No ) break;;
        esac
    done
fi

package="athena-firefox-config"
if pacman -Qi $package > /dev/null 2>&1 ; then
    echo -e "\e[33m[10/16] Do you wish to update Firefox Browser profile? Type 'No' if you added additional bookmarks or extensions in the current profile.\e[0m"
    select yn in "Yes" "No"; do
        case $yn in
            Yes ) 
            systemctl --user stop psd
            systemctl --user disable psd
            mkdir -p "$HOME/.mozilla/firefox-esr"
            sudo rsync -a --delete "/etc/skel/.mozilla/firefox-esr/" "$HOME/.mozilla/firefox-esr/"; rsync -a --delete "/etc/skel/.config/psd/" "$HOME/.config/psd/"
            sudo chown -LR $USER "$HOME/.mozilla"; sudo chgrp -LR $USER "$HOME/.mozilla"
            systemctl --user enable psd
            systemctl --user start psd
            break;;
            No ) break;;
        esac
    done
fi

package="athena-fish"
if pacman -Qi $package > /dev/null 2>&1 ; then
    echo -e "\e[33m[11/16] Do you wish to update FISH config files? Type 'No' if you customized them.\e[0m"
    select yn in "Yes" "No"; do
        case $yn in
            Yes ) rsync -a --delete "/etc/skel/.config/fish/" "$HOME/.config/fish/"; break;;
            No ) break;;
        esac
    done
fi

package="athena-zsh"
if pacman -Qi $package > /dev/null 2>&1 ; then
    echo -e "\e[33m[11/16] Do you wish to update ZSH .zshrc file? Type 'No' if you customized them.\e[0m"
    select yn in "Yes" "No"; do
        case $yn in
            Yes ) rsync "/etc/skel/.zshrc" "$HOME/.zshrc"; break;;
            No ) break;;
        esac
    done
fi

echo -e "\e[33m[12/16] Do you wish to update Neovim plugin and config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.cache/nvim/" "$HOME/.cache/nvim/"; rsync -a --delete "/etc/skel/.config/nvim/" "$HOME/.config/nvim/"; rsync -a --delete "/etc/skel/.local/share/nvim/" "$HOME/.local/share/nvim/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[13/16] Do you wish to update VSCode theme and config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.config/Code - OSS/User/" "$HOME/.config/Code - OSS/User/"; rsync -a --delete "/etc/skel/.vscode-oss/extensions/" "$HOME/.vscode-oss/extensions/"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[14/16] Do you wish to update Athena Welcome config files? Type 'No' if you customized them.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.config/athena-welcome/" "$HOME/.config/athena-welcome/"; rsync "/etc/skel/.config/autostart/athena-welcome.desktop" "$HOME/.config/autostart/athena-welcome.desktop"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[15/16] Do you wish to update Hack The Box .htb.conf file? Type 'No' if you edited it.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync "/etc/skel/.htb.conf" "$HOME/.htb.conf"; break;;
        No ) break;;
    esac
done

echo -e "\e[33m[16/16] Do you wish to update textart files? Type 'No' if you edited it.\e[0m"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) rsync -a --delete "/etc/skel/.local/textart/" "$HOME/.local/textart/"; break;;
        No ) break;;
    esac
done

### Here report new packages that need to be installed by default in Athena in order that also old users can get them
# sudo pacman -S <package-name>

# At the end, run run-once
source /etc/profile.d/run-once.sh > /dev/null 2>&1
