#!/bin/sh

############################################################
# Colors                                                   #
############################################################

cecho() {
	# Reset
	Color_Off='\033[0m'       # Text Reset

	# Regular Colors
	#Black='\033[0;30m'        # Black
	Red='\033[0;31m'          # Red
	Green='\033[0;32m'        # Green
	Yellow='\033[0;33m'       # Yellow
	Blue='\033[0;34m'         # Blue
	Purple='\033[0;35m'       # Purple
	Cyan='\033[0;36m'         # Cyan
	White='\033[0;37m'        # White

	# Bold
	#BBlack='\033[1;30m'       # Black
	BRed='\033[1;31m'         # Red
	BGreen='\033[1;32m'       # Green
	BYellow='\033[1;33m'      # Yellow
	BBlue='\033[1;34m'        # Blue
	BPurple='\033[1;35m'      # Purple
	BCyan='\033[1;36m'        # Cyan
	BWhite='\033[1;37m'       # White

	COLOURS=($Color_Off $Black $Red $Green $Yellow $Blue $Purple $Cyan $White $BBlack $BRed $BGreen $BYellow $BBlue $BPurple $BCyan $BWhite)

	rand=$(( RANDOM % 17 ))

    echo -e "${COLOURS[$rand]}"
}

############################################################
# Banner                                                     #
############################################################
#cat banner.txt | gzip | base64
banner()
{
   echo
   base64 -d <<<"H4sIAAAAAAAAA7WWvY7rOAyF+zyF1d1KrgQBwmIJpAmgyq0AQ36RQM++51DyXyY/9myuMBPbMc3PJA+pdN3fX5fjptaG7L03xeRg/xLEluhuuobBpSimHEadiKTrggwg4D+55JxLScL3ITPmlkhI/Izl+5Cuy+k23BgGAMqRz0k7Dem6CAjKwgWOG+TbEFWYRMQAzuAGft4+Uk6oK+RcDARsDIXsvaThpjpw/xsC35BQKCalgh4hgxT9FNX01X2qyluIDYbevM1wG50v2aQhCVnEIJhBVWZ+C0EExYtINEWECfK+aCi6MnsfnFxNfwUJIZu2pBRBeyM1SL/kMlMKITkf6sYnEBtKKS3x8JQBSSmyCePC4H1BbPlIL/6EWEjItwU3YrKPGFpXMBKrINqCSXAPmFKOzK8HCBD6/qXq1GAMFo2j9kVrwuiGGFEfhnI6khYFu4EU9VLE6fAwKIpHVFRThMaisFf8oUG8g+SWKKSadVWGd5Spp5YBxNRKBqAbhMxQz0/hwCCaSmuDQL7uNkQlQ0pZEEFGvDKIZnONw74LaQPROMw+V1HnYERxBNshlB34z84hZROHNezR8Jy1QrKps8JoP0NWwLAYaHUXMRMhJR1ees9zSsZd1TPLVa0eWQskIIaSaxz0gyY02VBTQ910b9erbrwOHeOgLSps58pKUlUIXynKRtwLpAhCWcoh/LnQdai6Iq4Yt8prMkZw3jtnOkxmJJAjCI/RN/WuiK0kVojXNqYxZ5TRFwni5kDqLqU7O9IXhwE9aoQi43ATPpGlQnx5EN0CsVmHxQya041MD/NPlHXxx4R2Z+Lcyc3YalWeyHotfPCqKYO6ALJ+bYQS058py4Iq2D8Iy29kbFCq/ExeK6RoZ3C+oiOKtTXRDE/SJgRGxKkYmJhd6oO8GmSbSLJmqgQ8yFnOgoIUjE6SlNaaJM6EAKnufb5sx00vwh8aze5swW2ItqIuFBrT+fBP1U9bfEZHSvUcUwNoz5amv29AQhVc21x0XrXt9+Cm+Bli4Qnelu2wXuaif+E7EPXISu3zkjWO4yV5C5kZj95CPhPGewjHun06uu2JeryF2J8RbCkvNo6TkA/rDOPXkDOLjIlLj3hBPXu1pnW9N9xavjJo+B7nXTdOON6nOz+m9vx8WLyM9YCr/pnh5nJjOan/5ma24+M4v5DeTyMeUOtR7/BdYDTyJq7U16gvfZ8/7k8M18uN5diNPf/6eqv54uP47tIvpkrmWdLzFqJ6qE9OD/i9Ydpc7l60vnc/36q+9O4/3WVkMjSNPY5MKAvQj5qif+vVn5ower1P9aufhvft5dYSb6+VXV02GN5ikffYr7Jo508Pu/Vw643lC8+X/wAALQtT9hEAAA==" | gunzip
   echo
}
############################################################
# Help                                                     #
############################################################
Help()
{
   # Display Help
   banner
   echo
   echo "Athena Theme Tweak allows you to easily switch to different Athena themes."
   echo
   echo "Options:"
   echo "-c                        Random colored output."
   echo "-h                        Print this Help."
   echo "-l                        List all available Athena themes."
   echo "-t                        Specify an Athena theme to be set."
   echo
   echo "Usage Examples"
   echo
   echo "Set Athena Blue Eyes Samurai theme:" 
   echo "athena-theme-tweak -t BlueEyesSamurai"
   echo
}

############################################################
# Process the input options. Add options as needed.        #
############################################################
# Get the options
while getopts "chlt:" option; do #When using getopts, putting : after an option character means that it requires an argument (i.e., 'i:' requires arg).
   case "${option}" in
      c)
         cecho
         ;;
      h) # display Help
         Help >&2
         exit 0
         ;;
      l) # 
         list=1
         ;;
      t)
         theme=$OPTARG
         ;;
      : )
        echo "Missing option argument for -$OPTARG" >&2; exit 0;;
      *  )
        echo "Unimplemented option: -$OPTARG" >&2; exit 0;;
     \?) # Invalid option
        echo "Error: Invalid option" >&2
         ;;
   esac
done

banner

echo
############################################################
############################################################
# Main program                                             #
############################################################
############################################################

array_theme_packages=()
array_theme_packages+=("athena-akame-theme")
array_theme_packages+=("athena-blue-eyes-theme")
array_theme_packages+=("athena-graphite-theme")
array_theme_packages+=("athena-gruvbox-theme")
array_theme_packages+=("athena-sweet-dark-theme")

array_theme_names=()
array_theme_names+=("AkameGaKill")
array_theme_names+=("BlueEyesSamurai")
array_theme_names+=("Graphite")
array_theme_names+=("CyborgGruvbox")
array_theme_names+=("SweetDark")

len=${#array_theme_packages[@]}

if [[ "$list" -eq 1 ]]; then
   echo "Theme List:"
   echo
   for (( i=0; i<$len; i++ ))
   do
     echo "${array_theme_names[$i]}"
   done
fi

if [ "$theme" ]; then
    for i in ${!array_theme_names[@]}
    do
      if [ "${array_theme_names[$i]}" = "$theme" ]; then
        found_flag=1
        theme_package=${array_theme_packages[$i]}
        
        echo "Uninstalling all the previous installed Athena themes for avoiding conflicts..."
	echo
	for j in ${!array_theme_names[@]}
   do
          { # try

    	    sudo pacman -Rs --noconfirm ${array_theme_packages[$j]} 2>/dev/null

	  } || { # catch
    	    # Error handling
	    echo "${array_theme_packages[$j]} not installed." 
	  }
	done

        echo "Installing $theme Theme..."
        echo
        sudo pacman -Syy --noconfirm $theme_package

        rm -rf "${HOME}/.config/gtk-4.0"
        mkdir -p "${HOME}/.config/gtk-4.0"

        if [ "${theme_package}" = "athena-akame-theme" ]; then
           gsettings set org.gnome.desktop.interface color-scheme prefer-dark
           gsettings set org.gnome.desktop.interface gtk-theme Abyss-BLOOD-3.36
           gsettings set org.gnome.desktop.wm.preferences theme Graphite-Dark
           gsettings set org.gnome.desktop.interface icon-theme Material-Black-Cherry-Suru
           gsettings set org.gnome.desktop.interface cursor-theme Bibata-Modern-DarkRed
           gsettings set org.gnome.desktop.background picture-uri-dark file:///usr/share/backgrounds/default/akame.jpg
           gsettings set org.gnome.desktop.background picture-uri file:///usr/share/backgrounds/default/akame.jpg
           gsettings set org.gnome.desktop.background picture-options stretched
           sed -i 's/"workbench.colorTheme":.*/"workbench.colorTheme": "red-blood",/g' "$HOME/.config/Code - OSS/User/settings.json"
           cp -rf $HOME/.config/kitty/kitty-themes/themes/CrayonPonyFish.conf $HOME/.config/kitty/current-theme.conf
           sudo sed -i "s/Inherits=.*/Inherits=Bibata-Modern-DarkRed/g" /usr/share/icons/default/index.theme
           sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme 'redwine'/g" $HOME/.tmux.conf
        fi

        if [ "${theme_package}" = "athena-blue-eyes-theme" ]; then
           gsettings set org.gnome.desktop.interface color-scheme prefer-dark
           gsettings set org.gnome.desktop.interface gtk-theme Tokyonight-Dark-B
           gsettings set org.gnome.desktop.wm.preferences theme Graphite-Dark
           gsettings set org.gnome.desktop.interface icon-theme tokyonight_dark
           gsettings set org.gnome.desktop.interface cursor-theme oreo_blue_cursors
           gsettings set org.gnome.desktop.background picture-uri-dark file:///usr/share/backgrounds/default/blue-eyes.jpg
           gsettings set org.gnome.desktop.background picture-uri file:///usr/share/backgrounds/default/blue-eyes.jpg
           gsettings set org.gnome.desktop.background picture-options stretched
           gsettings set org.gnome.shell.extensions.user-theme name "Tokyonight-Dark-B"
           sed -i 's/"workbench.colorTheme":.*/"workbench.colorTheme": "Tokyo Night Storm",/g' "$HOME/.config/Code - OSS/User/settings.json"
           cp -rf $HOME/.config/kitty/kitty-themes/themes/Tokyo_Night_Storm.conf $HOME/.config/kitty/current-theme.conf
           sudo sed -i "s/Inherits=.*/Inherits=oreo_blue_cursors/g" /usr/share/icons/default/index.theme
           sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme 'sky'/g" $HOME/.tmux.conf
           ln -sf "/usr/share/themes/Tokyonight-Dark-B/gtk-4.0/assets" "${HOME}/.config/gtk-4.0/assets"
           ln -sf "/usr/share/themes/Tokyonight-Dark-B/gtk-4.0/gtk.css" "${HOME}/.config/gtk-4.0/gtk.css"
           ln -sf "/usr/share/themes/Tokyonight-Dark-B/gtk-4.0/gtk-dark.css" "${HOME}/.config/gtk-4.0/gtk-dark.css"
        fi

        if [ "${theme_package}" = "athena-graphite-theme" ]; then
           gsettings set org.gnome.desktop.interface color-scheme prefer-dark
           gsettings set org.gnome.desktop.interface gtk-theme Graphite-Dark
           gsettings set org.gnome.desktop.wm.preferences theme Graphite-Dark
           gsettings set org.gnome.desktop.interface icon-theme Tela-circle-black-dark
           gsettings set org.gnome.desktop.interface cursor-theme Bibata-Modern-Ice
           gsettings set org.gnome.desktop.background picture-uri-dark file:///usr/share/backgrounds/default/arch-ascii.png
           gsettings set org.gnome.desktop.background picture-uri file:///usr/share/backgrounds/default/arch-ascii.png
           gsettings set org.gnome.desktop.background picture-options stretched
           gsettings set org.gnome.shell.extensions.user-theme name "Graphite-Dark"
           sed -i 's/"workbench.colorTheme":.*/"workbench.colorTheme": "Just Black",/g' "$HOME/.config/Code - OSS/User/settings.json"
           cp -rf $HOME/.config/kitty/kitty-themes/themes/Atom.conf $HOME/.config/kitty/current-theme.conf
           sudo sed -i "s/Inherits=.*/Inherits=Bibata-Modern-Ice/g" /usr/share/icons/default/index.theme
           sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme 'snow'/g" $HOME/.tmux.conf
           ln -sf "/usr/share/themes/Graphite-Dark/gtk-4.0/assets" "${HOME}/.config/gtk-4.0/assets"
           ln -sf "/usr/share/themes/Graphite-Dark/gtk-4.0/gtk.css" "${HOME}/.config/gtk-4.0/gtk.css"
           ln -sf "/usr/share/themes/Graphite-Dark/gtk-4.0/gtk-dark.css" "${HOME}/.config/gtk-4.0/gtk-dark.css"
        fi

        if [ "${theme_package}" = "athena-gruvbox-theme" ]; then
           gsettings set org.gnome.desktop.interface color-scheme prefer-dark
           gsettings set org.gnome.desktop.interface gtk-theme Gruvbox-Dark-B
           gsettings set org.gnome.desktop.wm.preferences theme Graphite-Dark
           gsettings set org.gnome.desktop.interface icon-theme Material-Black-Mango-Suru
           gsettings set org.gnome.desktop.interface cursor-theme Fuchsia-Pop
           gsettings set org.gnome.desktop.background picture-uri-dark file:///usr/share/backgrounds/default/cyborg_gruv.png
           gsettings set org.gnome.desktop.background picture-uri file:///usr/share/backgrounds/default/cyborg_gruv.png
           gsettings set org.gnome.desktop.background picture-options stretched
           gsettings set org.gnome.shell.extensions.user-theme name "Gruvbox-Dark-B"
           sed -i 's/"workbench.colorTheme":.*/"workbench.colorTheme": "Gruvbox Material Dark",/g' "$HOME/.config/Code - OSS/User/settings.json"
           cp -rf $HOME/.config/kitty/kitty-themes/themes/gruvbox_dark.conf $HOME/.config/kitty/current-theme.conf
           sudo sed -i "s/Inherits=.*/Inherits=Fuchsia-Pop/g" /usr/share/icons/default/index.theme
           sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme 'gold'/g" $HOME/.tmux.conf
           ln -sf "/usr/share/themes/Gruvbox-Dark-B/gtk-4.0/assets" "${HOME}/.config/gtk-4.0/assets"
           ln -sf "/usr/share/themes/Gruvbox-Dark-B/gtk-4.0/gtk.css" "${HOME}/.config/gtk-4.0/gtk.css"
           ln -sf "/usr/share/themes/Gruvbox-Dark-B/gtk-4.0/gtk-dark.css" "${HOME}/.config/gtk-4.0/gtk-dark.css"
        fi

        if [ "${theme_package}" = "athena-sweet-dark-theme" ]; then
           gsettings set org.gnome.desktop.interface color-scheme prefer-dark
           gsettings set org.gnome.desktop.interface gtk-theme Sweet-Dark-v40
           gsettings set org.gnome.desktop.wm.preferences theme Sweet-Dark-v40
           gsettings set org.gnome.desktop.interface icon-theme Sweet-Purple
           gsettings set org.gnome.desktop.interface cursor-theme oreo_spark_purple_cursors
           gsettings set org.gnome.desktop.background picture-uri-dark file:///usr/share/backgrounds/default/neon_circle.jpg
           gsettings set org.gnome.desktop.background picture-uri file:///usr/share/backgrounds/default/neon_circle.jpg
           gsettings set org.gnome.desktop.background picture-options stretched
           gsettings set org.gnome.shell.extensions.user-theme name "Sweet-Dark-v40"
           sed -i 's/"workbench.colorTheme":.*/"workbench.colorTheme": "Radical",/g' "$HOME/.config/Code - OSS/User/settings.json"
           cp -rf $HOME/.config/kitty/kitty-themes/themes/AdventureTime.conf $HOME/.config/kitty/current-theme.conf
           sudo sed -i "s/Inherits=.*/Inherits=oreo_spark_purple_cursors/g" /usr/share/icons/default/index.theme
           sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme 'violet'/g" $HOME/.tmux.conf
           ln -sf "/usr/share/themes/Sweet-Dark-v40/assets" "${HOME}/.config/assets"
           ln -sf "/usr/share/themes/Sweet-Dark-v40/gtk-4.0/gtk.css" "${HOME}/.config/gtk-4.0/gtk.css"
           ln -sf "/usr/share/themes/Sweet-Dark-v40/gtk-4.0/gtk-dark.css" "${HOME}/.config/gtk-4.0/gtk-dark.css"
        fi

        # Check the browser
        if pacman -Qs "athena-firefox-config" > /dev/null ; then
	       dconf dump /org/gnome/shell/ > $HOME/.tmp.txt
               sed -i "s/{\"name\":\"Brave\",\"icon\":\"\/usr\/share\/icons\/pentoxic\/brave.png\",\"type\":\"Command\",\"data\":{\"command\":\"brave\"},\"angle\":-1}/{\"name\":\"Firefox ESR\",\"icon\":\"\/usr\/share\/icons\/pentoxic\/firefox_logo_arch-256x256.png\",\"type\":\"Command\",\"data\":{\"command\":\"firefox-esr\"},\"angle\":-1}/g" $HOME/.tmp.txt
	       dconf load /org/gnome/shell/ < $HOME/.tmp.txt
          rm -rf $HOME/.tmp.txt
	     elif pacman -Qs "athena-brave-config" > /dev/null ; then
          dconf dump /org/gnome/shell/ > $HOME/.tmp.txt
               sed -i "s/{\"name\":\"Firefox ESR\",\"icon\":\"\/usr\/share\/icons\/pentoxic\/firefox_logo_arch-256x256.png\",\"type\":\"Command\",\"data\":{\"command\":\"firefox-esr\"},\"angle\":-1}/{\"name\":\"Brave\",\"icon\":\"\/usr\/share\/icons\/pentoxic\/brave.png\",\"type\":\"Command\",\"data\":{\"command\":\"brave\"},\"angle\":-1}/g" $HOME/.tmp.txt
	       dconf load /org/gnome/shell/ < $HOME/.tmp.txt
          rm -rf $HOME/.tmp.txt
	     fi
      fi
    done
    if [[ ! "$found_flag" ]]; then
        echo "Theme not found!"
        exit 0
    fi
    echo "Logout or reboot for applying correctly the new theme."
fi
